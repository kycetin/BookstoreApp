

{% extends "base_generic.html" %}

{% block content %}

<div class="modal fade" id="info-modal" tabindex="-1" aria-labelledby="infoModal" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">...</div>
    </div>
  </div>
</div>
{% if ls %}
    <div class="row row-cols-1 row-cols-md-4 g-4 ">
      {% for list in ls %}
      <div id="book{{list.isbn13}}" class="col">
      <div class="card"><img src={{list.image}}>
        <div class="info">
          <h4>{{list.title}}</h4>
          <p>{{list.subtitle}}</p>
          <p>{{list.price}}</p>
          <button id="readMore{{list.isbn13}}" type="button" class="btn btn-dark" value="{{list.isbn13}}" onclick="readMore()">Read More</button>
          <button id="{{list.isbn13}}" type="button" class="btn btn-dark" onclick="deleteBookmark()">Delete Bookmark</button>
        </div>
      </div>
      </div>
      {% endfor %}
    </div>
{% else %}
      <h4>Bookmark list empty</h4>
{% endif %}
<nav >
  <ul class="pagination justify-content-center">
        {% if  current_page > 1 %}
            <li class="page-item">
              <a class="page-link" href="/bookmarks/1" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">First</span>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="/bookmarks/{{current_page|add:'-1'}}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Previous</span>
              </a>
            </li>
        {% endif %}
        {% for i in range %}
            {% if  i|add:'-5' < current_page and i|add:'5' > current_page  %}
                {% if i == current_page %}
                    <li class="page-item active" aria-current="page">
                    <a class="page-link" href="/bookmarks/{{i}}">{{i}}</a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="/bookmarks/{{i}}">{{i}}</a></li>
                {% endif %}
            {% endif %}
        {% endfor %}
        {% if current_page < pg %}
            <li class="page-item">
        {% if current_page == 0 %}
              <a class="page-link" href="/bookmarks/{{current_page|add:'2'}}" aria-label="Next">
                {% else %}
              <a class="page-link" href="/bookmarks/{{current_page|add:'1'}}" aria-label="Next">
        {% endif %}
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Next</span>
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="/bookmarks/{{pg}}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Last</span>
              </a>
            </li>
        {% endif %}
  </ul>
</nav>

<script>

function deleteBookmark() {
    // console.log($(this).attr("id"));
    buttonId = event.srcElement.id;
    let cookie = document.cookie
let csrfToken = cookie.substring(cookie.indexOf('=') + 1)

  $.ajax({
  url: '/bookmarks/delete_bookmark/',
  method : 'POST',
         headers: {
           'X-CSRFToken': csrfToken
         },
      data: {"button_id": buttonId,"current":{{current_page}}},
  beforeSend: function() {
   // things to do before submit
  },
  success: function(data) {
// location.reload(); 
      console.log(data.response);
 $('#book'+data.response).remove();
      $('#info-modal').modal('hide');
   }
   });
    
}
  

  
 function readMore(){

    let buttonId = event.srcElement.value;
    console.log(buttonId);
    let cookie = document.cookie
let csrfToken = cookie.substring(cookie.indexOf('=') + 1)

  $.ajax({
  url: '/read_more/',
  method : 'POST',
         headers: {
           'X-CSRFToken': csrfToken
         },
  data: {"button_id": buttonId},
  beforeSend: function() {
   // things to do before submit
  },
  success: function(data) {
      let books = data.data;
      console.log(books.title);
      $('#info-modal .modal-body ').html(`
  <div class="card-modal"><img class="image-modal" src=${books.image}>
    <div class="info-modal">
      <h4>${books.title}</h4>
<table class="table table-striped align-middle">
  <tbody>
    <tr>
      <td colspan="2">Price</td>
      <td colspan="2">${books.price}</td>
    </tr>
    <tr>
      <td colspan="2">Rating</td>
      <td colspan="2">${books.rating}/5</td>
    </tr>
    <tr>
      <td colspan="2">Author</td>
      <td colspan="2">${books.authors}</td>
    </tr>
    <tr>
      <td colspan="2">Published</td>
      <td colspan="2">${books.year}</td>
    </tr>
    <tr>
      <td colspan="2">Pages</td>
      <td colspan="2">${books.pages}</td>
    </tr>
    <tr>
      <td colspan="2">ISBN-10</td>
      <td colspan="2">${books.isbn10}</td>
    </tr>
    <tr>
      <td colspan="2">ISBN-13</td>
      <td colspan="2">${books.isbn13}</td>
    </tr>
    <tr>
      <td colspan="2">Description</td>
      <td colspan="2">${books.desc}</td>
    </tr>
  </tbody>
</table>
      <button id="${books.isbn13}" type="button" class="btn btn-dark" value="${books.isbn13}" onclick="deleteBookmark()">Delete Bookmark</button>
    </div>
  </div>
`);
      $('#info-modal').modal('show');

   }
   });
 }
</script>

{% endblock %}
